



@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Admin/_Layout.cshtml";



}

<br />

<section class="content">
    <div class="row">
        <div class="col-md-12">
            <!-- Custom Tabs -->
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#tab_1" data-toggle="tab">Bảng điều khiển</a></li>
                    <li><a href="#tab_2" data-toggle="tab">Hóa đơn</a></li>
                    <li><a href="#tab_3" data-toggle="tab">Sản phẩm</a></li>
                    <li>
                        <a href="#tab_4" data-toggle="tab">Tài khoản</a>
                    </li>
                    <li class="pull-right"><a href="#" class="text-muted"><i class="fa fa-gear"></i></a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane" id="tab_1">
                        <div class="nav-tabs-custom">
                            <ul class="nav nav-tabs">
                                <li id="tab_sales_wrapper"><a href="#tab_chartSalesWrapper" data-toggle="tab">Doanh số</a></li>
                                <li id="tab_account_wrapper"><a href="#tab_chartAccountWrapper" data-toggle="tab">Tài khoản</a></li>
                            </ul>
                            <div class="tab-content">
                                <div id="tab_chartSalesWrapper" class="tab-pane fade">

                                    <div class="row">
                                        <div class="col">
                                            <p>Ngày bắt đầu</p>
                                            <input id="salesReportStartDatePicker" />
                                        </div>

                                        <div class="col">
                                            <p>Ngày kết thúc</p>
                                            <input id="salesReportEndDatePicker" />
                                        </div>
                                    </div>

                                    <button onclick="onFilterSalesChart()" class="btn btn-primary">Lọc</button>

                                    <div id="salesReport"></div>
                                </div>

                                <div id="tab_chartAccountWrapper" class="tab-pane fade">
                                    <div class="row">
                                        <div class="col">
                                            <p>Ngày bắt đầu</p>
                                            <input id="accountReportStartDatePicker" />
                                        </div>

                                        <div class="col">
                                            <p>Ngày kết thúc</p>
                                            <input id="accountReportEndDatePicker" />
                                        </div>
                                    </div>

                                    <button onclick="onFilterAccountChart()" class="btn btn-primary">Lọc</button>
                                    <div id="accountReport"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /.tab-pane -->
                    <div class="tab-pane" id="tab_2">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="box box-default">
                                    <div class="box-header">
                                        <h4>Báo cáo sản lượng hóa đơn</h4>
                                    </div>
                                    <div class="box-body">
                                        <div class="col-md-12">
                                            <div class="form-group row">
                                                <div class="col-md-6">
                                                    <div class="col-md-2">
                                                        <label>Từ ngày: </label>
                                                    </div>
                                                    <div class="col-md-10">
                                                        <input id="fromTime" class="form-control" />
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="col-md-2">
                                                        <label>Đến ngày: </label>
                                                    </div>
                                                    <div class="col-md-10">
                                                        <input id="toTime" class="form-control" />
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="box-footer">
                                        <button class="btn btn-primary" id="exportBill">Xuất báo cáo</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <!-- /.tab-pane -->
                    <div class="tab-pane" id="tab_3">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="box box-default">
                                    <div class="box-header">
                                        <h4>Báo cáo sản phẩm</h4>
                                    </div>
                                    <div class="box-body">
                                        <div class="col-md-12">
                                            <div class="form-group row">
                                                <div class="col-md-6">
                                                    <div class="col-md-2">
                                                        <label>Từ ngày: </label>
                                                    </div>
                                                    <div class="col-md-10">
                                                        <input id="productFromTime" class="form-control" />
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="col-md-2">
                                                        <label>Đến ngày: </label>
                                                    </div>
                                                    <div class="col-md-10">
                                                        <input id="productToTime" class="form-control" />
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="box-footer">
                                        <button class="btn btn-primary" id="exportProducts">Xuất báo cáo</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="tab-pane" id="tab_4">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="box box-default">
                                    <div class="box-header">
                                        <h4>Báo cáo tài khoản</h4>
                                    </div>
                                    <div class="box-body">
                                        <div class="col-md-12">
                                            <div class="form-group row">
                                                <div class="col-md-6">
                                                    <div class="col-md-2">
                                                        <label>Từ ngày: </label>
                                                    </div>
                                                    <div class="col-md-10">
                                                        <input id="accountFromTime" class="form-control" />
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="col-md-2">
                                                        <label>Đến ngày: </label>
                                                    </div>
                                                    <div class="col-md-10">
                                                        <input id="accountToTime" class="form-control" />
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="box-footer">
                                        <button class="btn btn-primary" id="exportAccount">Xuất báo cáo</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <!-- /.tab-pane -->
                </div>
                <!-- /.tab-content -->
            </div>
            <!-- nav-tabs-custom -->
        </div>
    </div>
</section>


@section Scripts{
    <script>
        $(document).ready(function () {
            $('#fromTime').datepicker();
            $('#toTime').datepicker();
            $('#productFromTime').datepicker();
            $('#productToTime').datepicker();
            $('#accountFromTime').datepicker();
            $('#accountToTime').datepicker();
        });

        $('#exportBill').click(function () {
            var fromDate = $('#fromTime');
            var toDate = $('#toTime');

            if (fromDate.val() == "") {
                $('#noitifyHolder').data('kendoNoitification').show("Vui lòng chọn ngày bắt đầu", "error");
                return;
            }
            if (toDate.val() == "") {
                $('#noitifyHolder').data('kendoNoitification').show("Vui lòng chọn ngày kết thúc", "error");
                return;
            }
            var url = "/Exports/ExportsBill?fromDate=" + fromDate.val() + "&toDate=" + toDate.val();
            var win = window.open(url, "_blank");
            win.focus;
        });

        $('#exportProducts').click(function () {
            var fromDate = $('#productFromTime');
            var toDate = $("#productToTime");
            if (fromDate.val() == "") {
                $('#noitifyHolder').data('kendoNoitification').show("Vui lòng chọn ngày bắt đầu", "error");
                return;
            }
            if (toDate.val() == "") {
                $('#noitifyHolder').data('kendoNoitification').show("Vui lòng chọn ngày kết thúc", "error");
                return;
            }

            var url = "/Exports/ExportProducts?fromDate=" + fromDate.val() + "&toDate=" + toDate.val();
            var win = window.open(url, "_blank");
            win.focus();


        });

        $('#exportAccount').click(function () {
            var fromDate = $('#accountFromTime');
            var toDate = $("#accountToTime");
            if (fromDate.val() == "") {
                $('#noitifyHolder').data('kendoNoitification').show("Vui lòng chọn ngày bắt đầu", "error");
                return;
            }
            if (toDate.val() == "") {
                $('#noitifyHolder').data('kendoNoitification').show("Vui lòng chọn ngày kết thúc", "error");
                return;
            }

            var url = "/Exports/ExportAccount?fromDate=" + fromDate.val() + "&toDate=" + toDate.val();
            var win = window.open(url, "_blank");
            win.focus();
        });

        $("#tab_sales_wrapper").on("click", function () {
            loadSalesChart();
        });

        $("#tab_account_wrapper").on("click", function () {
            loadAccountChart();
        });

        function loadAccountChart() {
            console.log("loadAccountChart");
            $("#accountReportStartDatePicker").datepicker();
            $("#accountReportEndDatePicker").datepicker();
        }

        function onFilterAccountChart() {
            console.log("onFilterAccountChart");
            var dataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: "/Admin/MainService/GetAccountReport",
                        dataType: "json",
                        data: function () {
                            return {
                                startDate: $("#accountReportStartDatePicker").val(),
                                endDate: $("#accountReportEndDatePicker").val()
                            }
                        }
                    }
                },
            });


            $("#accountReport").kendoChart({
                title: {
                    text: "Tài khoản đăng kí mới"
                },
                dataSource: dataSource,
                series: [{
                    type: "line",
                    aggregate: "avg",
                    field: "value",
                    categoryField: "date"
                }],
                categoryAxis: {
                    baseUnit: "weeks"
                }
            });
        }

        function loadSalesChart() {
            console.log("loadSalesChart");
            $("#salesReportStartDatePicker").datepicker();
            $("#salesReportEndDatePicker").datepicker();
        }

        function onFilterSalesChart() {
            var dataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: "/Admin/MainService/GetSalesReport",
                        dataType: "json",
                        data: function () {
                            return {
                                startDate: $("#salesReportStartDatePicker").val(),
                                endDate: $("#salesReportEndDatePicker").val()
                            }
                        }
                    }
                },
            });


            $("#salesReport").kendoChart({
                title: {
                    text: "Biểu đồ doanh số"
                },
                dataSource: dataSource,
                series:
                    [{
                        type: "line",
                        field: "value",
                        categoryField: "date",
                        axis: "revenue"
                    },
                    {
                        type: "area",
                        field: "totalRevenue",
                        categoryField: "date",
                        axis: "count"
                    }],
                valueAxes:
                    [{
                        name: "count",
                        color: "#007eff"
                    }, {
                        name: "revenue",
                        color: "#73c100"
                    }],
                tooltip: {
                    visible: true,
                    format: "{0}",
                    template: "#= date #: #= count # : #= revenue #"
                }
            });
        }
    </script>

}